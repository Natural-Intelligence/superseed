# superseed

Smart seed generation.

# Install

```
npm i @superseed/superseed
```

# Usage

### 1. Require Seed helpers
```js
const {Seeder, SeedJob} = require('@superseed/superseed');
```

### 2. Define seed jobs
```js
const peopleSeeder = new SeedJob(<key>, <generator>, <seeder>);
```
SeedJobs's contructor takes 3 parameters
- Key: An entity key
- Generator: a mock generator
- Seeder: An instance of DataSource  for storing generated seeds. 

*Example:*
```js
 class CustomGenerator extends BaseMockGenerator {
  generate(db, count) {
   // generate some mock data
  }
}
class CustomSeeded extends BasedataSource{
    createSeeds(seeds){
       // save seed somewhere
    }
}
const mySeedJob = new SeedJob('myentity', new CustomGenerator(), new CustomSeeded());
```

## 3. Add Seed job to a new seed object and execute
```js
const seeder = new Seeder();
seeder.addJob(peopleSeeder, 2);
const data = await seeder.seed();
````

## 4. Delete seeds
```js
await seeder.unseed();

```
## All of the steps above together

```js
const {Seeder, SeedJob} = require('@superseed/superseed');
const peopleSeeder = new SeedJob(<key>, <generator>, <seeder>);

const seeder = new Seeder();
seeder.addJob(peopleSeeder, {count: 2});
const data = await seeder.seed();

await seeder.unseed();
```


# Mock Generators
Mock generators generate mock data for seed.
The mock generators below can be used when creating seed
- (@superseed/mocker-data-generator)[https://www.npmjs.com/package/@superseed/mocker-data-generator]: Generate seeds based on (mocker-data-generator)[https://www.npmjs.com/package/mocker-data-generator] Schema.
- (@superseed/mongoose)[https://www.npmjs.com/package/@superseed/mongoose]: Generate seeds based on  (mongoose)[https://www.npmjs.com/package/mongoose] schema. 

## Creating custom Mock generators
*Example:*
```js
const {BaseMockGenerator} = require('@superseed/core');

class MyGenerator extends BaseMockGenerator {
  generateMock(db, staticFields) {
    return {
      name: 'test'
    };
  }
}
```

# Data Sources

Data sources define the target source for the data generated by seeds.
Available datasources
- (@superseed/mongodb)[https://www.npmjs.com/package/@superseed/mongodb]: Allows saving of seeds to MpngoDB.
- (@seperseed/restapi)[https://www.npmjs.com/package/@superseed/restapi]: Allows saving seeds via REST API.

## Creating custom Data Sources
*Example:*
```js
const {BaseDataSource} = require('@superseed/core');

class MyDataSources extends BaseMockGenerator {
  createSeeds(seeds) {
    // save seed
  }
  deleteSeeds() {
    // delete seed. 
    // NOTE: a reference to seeds created must be kept for later deletion 
  }
}
```

# Methods

### constructor(db, options)
Arguments
 * `db` \<Object\> Original db
 * `options` \<Object\>
   * `errorHandler` \<function\> A function for handling errors. Receives and exception as first argument
 
### addJob (seedJob)
Defines a seed job type for an entity and add a seed job.
Arguments
 * `seedJob` \<SeedJob\> a seed job defined with SeedJob class

Calling `seeder.addJob(seedJob)` Is the same as 

```js
seeder.defineJob(seedJob.getKey(), seedJob)
.addSeed(seedJob.getKey(), options)
```

### addSeed(entityKey, options)
Add a seed for a entity. Must be called after a seed job is defined for than entity key.
Arguments 
* `entityKey` \<String\> the key identifying the target entity.
* `options` \<Object\> 
  * `count` \<number\>
  * `staticFieldData` \<Array\>  Define Static data for seed. If supplied count is ignored.
  * `getStaticFieldData` \<function\> A callback that returns static data for seed. If supplied count is ignored. Is called per  seed job.
  * `geStaticFields` \<function\> (with count) A callback that returns static data per mock. Is called per mock.

### defineJob(entityKey, seedJob)
Define a seed job handler for an entity. When creating seeds this job is used to creating seeds
 
 
# Advanced seed Jobs examples
When adding a seed job to a seed the following option values can be used

## count
Define the number of seeds to create.
```js
// Example
seeder.addJob(job, {count: 2});
seeder.seed();// would generate 2 mock
```

## staticFieldData
Define Static data for seed. If supplied count is ignored.
```js
// Example:
seeder.addJob(job, {staticFieldData: [{name: 'John'}, {name: 'Moshe'}]});
seeder.seed();// would generate 2 mock object with names John and Moshe respectively
```

## getStaticFieldData
A callback that returns static data for seed. If supplied count is ignored. Is called per  seed job.
```js
// Example:
seeder.addJob(job, {getStaticFieldData: () => [{name: 'John'}, {name: 'Moshe'}]});
seeder.seed();// would generate 2 mock object with names John and Moshe respectively
```

## geStaticFields (with count)
A callback that returns static data per mock. Is called per mock.
```js
// Example:
seeder.addJob(job, {count: 2, geStaticFields: (db) => ({name: db.users[0].name}) });
seeder.seed();// would generate 2 mock object with names generated by the geStaticFields callback
```
 